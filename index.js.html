<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
const Op = require('object-path');

/**
 * Helper method that actually creates 
 * the target if it does not exist 
 * using the default value.
 * Object-path.get with default option 
 * does not sets the default value on the target path.
 * @param {Object} o The object containing the path
 * @param {String|Array} path a path to the target property inside the object
 * @param {any} def The default value to be used if the target does not exist. 
 *                  This value will be saved at the provided path inside the provided object
 * @return {any} The value at the provided path.
 */
const getOrDefault = (o, path, def) => {

    if (!Op.get(o, path)) {
        Op.set(o, path, def);
    }
    return Op.get(o, path);
};

class Report {

    constructor(notes, totalLabel, timestamp = Date.now()) {

        this.report = {
            summary: {
                total: {
                    count: 0,
                    label: totalLabel
                },
                timestamp,
                notes
            },
            results: {}
        };
    }

    section(name) {

        return new Section(getOrDefault(this.report, name, {}), this.report);
    }

    setTotal(value) {

        this.report.summary.total.count = value;
    }

    calcPercentOf(path, totalRef) {

        if (typeof totalRef !== 'string') {
            totalRef = 'summary.total.count'; // default reference is inside summary
        } else {
            totalRef = ['results', totalRef, 'count'].join('.'); // any other ref is under results namespace
        }
        if (typeof path !== 'string' || !Op.get(this.report.results, path) || isNaN(Op.get(this.report, totalRef))) {
            return this;
        }
        const count = Op.get(this.report, ['results', path, 'count'].join('.'));
        const total = Op.get(this.report, totalRef);
        const percent = (count * 100) / total;
        Op.set(this.report.results, path + '.percent', percent);
        return this;
    }

    toJSON() {

        return this.report;
    }
}

class Section {

    constructor(store, reportTree) {

        this.tree = reportTree;
        this.store = store;
    }

    toJSON(){

        return this.tree;
    }


    /** Legacy method from v1.0.0 Will be removed soon */
    subSection(){
        return this.section(...arguments);
    }

    section(name) {

        return new Section(getOrDefault(this.store, name, {}), this.tree);
    }

    summary(){

        return new Section(this.tree.summary, this.tree);        
    }
    

    calcPercent( totalRef ){

        if(typeof this.store.count !== 'number'){
            return this;
        }
        const count = this.store.count;
        const total = typeof totalRef !== 'string' 
                    ? this.tree.summary.total.count
                    : Op.get(this.tree, totalRef);
        this.store.percent = (count * 100) / total;
        return this;
    }

    set(path, value) {

        if (!path || !value) {
            return this;
        }
        Op.set(this.store, path, value);
        return this;
    }

    increment(path, value = 1) {

        if (typeof path === 'number') {
            value = path;
            path = 'count';
        } else {
            path = (typeof path === 'string')
                ? path.split('.')
                : [];
            path.push('count');
        }
        const currVal = Op.get(this.store, path, 0);
        Op.set(this.store, path, currVal + value);
        return this;
    }
}

module.exports = Report;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#getOrDefault">getOrDefault</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.0-dev</a> on Fri Dec 23 2016 18:39:37 GMT+0100 (Hora est√°ndar romance)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
